<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZK Wallet Demo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', sans-serif;
        }

        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }
    </style>
</head>

<body class="bg-slate-950 text-white min-h-screen">

    <!-- App Container -->
    <div id="app"
        class="max-w-md mx-auto min-h-screen bg-slate-950 relative shadow-2xl overflow-hidden border-x border-slate-800">

        <!-- Onboarding Screen -->
        <div id="screen-onboarding"
            class="absolute inset-0 z-50 bg-slate-950 flex flex-col items-center justify-center p-6 text-center transition-opacity duration-500">
            <div
                class="w-20 h-20 bg-indigo-600 rounded-3xl flex items-center justify-center mb-8 shadow-lg shadow-indigo-500/30">
                <i data-lucide="shield" class="w-10 h-10 text-white"></i>
            </div>
            <h1 class="text-4xl font-bold mb-4">ZK Wallet</h1>
            <p class="text-slate-400 mb-12 text-lg">Privacy-first crypto transactions with Zero-Knowledge proofs and
                Steganography.</p>

            <button onclick="router.push('dashboard')"
                class="w-full py-4 bg-indigo-600 rounded-xl font-bold text-lg hover:bg-indigo-500 transition-all transform hover:scale-105 shadow-lg shadow-indigo-500/20">
                Create New Wallet
            </button>
            <button class="mt-4 text-slate-500 font-medium hover:text-white transition-colors">Import Existing
                Wallet</button>
        </div>

        <!-- Dashboard Screen -->
        <div id="screen-dashboard" class="absolute inset-0 z-40 bg-slate-950 hidden flex flex-col">
            <!-- Header -->
            <div class="p-6 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center">
                        <i data-lucide="wallet" class="w-5 h-5 text-white"></i>
                    </div>
                    <span class="font-bold text-lg">My Wallet</span>
                </div>
                <button onclick="router.push('settings')" class="p-2 bg-slate-900 rounded-full hover:bg-slate-800"><i
                        data-lucide="settings" class="w-5 h-5 text-slate-400"></i></button>
            </div>

            <!-- Balance Card -->
            <div class="px-6 mb-8">
                <div
                    class="bg-gradient-to-br from-indigo-600 to-purple-700 rounded-3xl p-8 text-white shadow-xl relative overflow-hidden">
                    <div
                        class="absolute top-0 right-0 w-40 h-40 bg-white/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2">
                    </div>
                    <p class="text-indigo-200 font-medium mb-1">Total Balance</p>
                    <h2 class="text-4xl font-bold tracking-tight mb-6">1,250.00 <span
                            class="text-xl text-indigo-200">USDT</span></h2>
                    <div class="flex gap-3">
                        <button onclick="router.push('send')"
                            class="flex-1 bg-white text-indigo-600 py-2.5 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-indigo-50">
                            <i data-lucide="arrow-up-right" class="w-4 h-4"></i> Send
                        </button>
                        <button
                            class="flex-1 bg-indigo-500/30 text-white py-2.5 rounded-xl font-bold text-sm flex items-center justify-center gap-2 hover:bg-indigo-500/40 backdrop-blur-sm">
                            <i data-lucide="arrow-down-left" class="w-4 h-4"></i> Receive
                        </button>
                    </div>
                </div>
            </div>

            <!-- Transactions -->
            <div class="flex-1 bg-slate-900 rounded-t-3xl p-6 overflow-y-auto">
                <h3 class="font-bold text-lg mb-4">Recent Activity</h3>
                <div class="space-y-4">
                    <!-- Tx Item -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-10 h-10 rounded-full bg-emerald-500/10 flex items-center justify-center text-emerald-500">
                                <i data-lucide="arrow-down-left" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="font-medium">Received USDT</p>
                                <p class="text-xs text-slate-500">Today, 10:23 AM</p>
                            </div>
                        </div>
                        <span class="font-bold text-emerald-400">+500.00</span>
                    </div>
                    <!-- Tx Item -->
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div
                                class="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-500">
                                <i data-lucide="arrow-up-right" class="w-5 h-5"></i>
                            </div>
                            <div>
                                <p class="font-medium">Sent to Alice</p>
                                <p class="text-xs text-slate-500">Yesterday</p>
                            </div>
                        </div>
                        <span class="font-bold text-white">-120.00</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Screen -->
        <div id="screen-settings" class="absolute inset-0 z-40 bg-slate-950 hidden flex flex-col">
            <div class="p-6 flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <button onclick="router.back()" class="p-2 hover:bg-slate-900 rounded-full"><i
                            data-lucide="arrow-left" class="w-6 h-6"></i></button>
                    <h2 class="text-xl font-bold">Settings</h2>
                </div>
                <button onclick="router.push('dashboard')"
                    class="p-2 hover:bg-slate-900 rounded-full text-slate-400 hover:text-white">
                    <i data-lucide="home" class="w-6 h-6"></i>
                </button>
            </div>
            <div class="p-6 space-y-6">
                <div class="bg-slate-900 rounded-2xl p-4 border border-slate-800">
                    <h3 class="font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="shield" class="w-5 h-5 text-indigo-500"></i> Security
                    </h3>
                    <button onclick="settingsFlow.startChange()"
                        class="w-full flex items-center justify-between p-3 hover:bg-slate-800 rounded-xl transition-colors text-left">
                        <div>
                            <span class="text-slate-400 text-sm block">Transfer Auth</span>
                            <span class="text-white font-medium" id="active-method-display">Pattern</span>
                        </div>
                        <i data-lucide="chevron-right" class="w-5 h-5 text-slate-500"></i>
                    </button>
                </div>

                <div class="bg-slate-900 rounded-2xl p-4 border border-slate-800">
                    <h3 class="font-bold mb-4 flex items-center gap-2">
                        <i data-lucide="smartphone" class="w-5 h-5 text-indigo-500"></i> Devices
                    </h3>
                    <div class="flex items-center justify-between">
                        <span class="text-slate-400">My iPhone 15</span>
                        <span class="text-emerald-400 text-sm bg-emerald-500/10 px-2 py-1 rounded">Active</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings: Change Auth Method -->
        <div id="screen-settings-change" class="absolute inset-0 z-50 bg-slate-950 hidden flex flex-col">
            <div class="p-6 flex items-center gap-4">
                <button onclick="router.back()" class="p-2 hover:bg-slate-900 rounded-full"><i data-lucide="arrow-left"
                        class="w-6 h-6"></i></button>
                <h2 class="text-xl font-bold">Change Security</h2>
            </div>
            <div class="p-6 space-y-6">
                <p class="text-slate-400">Select a new method to use for transfer authorization.</p>
                <div class="grid grid-cols-2 gap-4">
                    <button onclick="settingsFlow.selectMethod('pin')"
                        class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                        <i data-lucide="grid" class="w-8 h-8 text-indigo-500"></i>
                        <span class="font-bold">PIN</span>
                    </button>
                    <button onclick="settingsFlow.selectMethod('pattern')"
                        class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                        <i data-lucide="lock" class="w-8 h-8 text-blue-500"></i>
                        <span class="font-bold">Pattern</span>
                    </button>
                    <button onclick="settingsFlow.selectMethod('password')"
                        class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                        <i data-lucide="key" class="w-8 h-8 text-amber-500"></i>
                        <span class="font-bold">Password</span>
                    </button>
                    <button onclick="settingsFlow.selectMethod('file')"
                        class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                        <i data-lucide="file-audio" class="w-8 h-8 text-pink-500"></i>
                        <span class="font-bold">File Key</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings: Dual Approval -->
        <div id="screen-settings-dual"
            class="absolute inset-0 z-50 bg-slate-950 hidden flex flex-col items-center justify-center p-6 text-center">
            <div class="w-20 h-20 bg-indigo-500/10 rounded-full flex items-center justify-center mb-6 animate-pulse">
                <i data-lucide="smartphone" class="w-10 h-10 text-indigo-500"></i>
            </div>
            <h2 class="text-2xl font-bold mb-2">Dual Approval Required</h2>
            <p class="text-slate-400 mb-8">To change security settings, approve on BOTH devices.</p>

            <div class="w-full space-y-4">
                <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between">
                    <span class="font-medium">Desktop</span>
                    <button id="btn-approve-desktop" onclick="settingsFlow.approve('desktop')"
                        class="px-4 py-2 bg-indigo-600 rounded-lg text-sm font-bold hover:bg-indigo-500">Approve
                        Here</button>
                </div>
                <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 flex items-center justify-between">
                    <span class="font-medium">Mobile (iPhone 15)</span>
                    <button id="btn-approve-mobile" onclick="settingsFlow.approve('mobile')"
                        class="px-4 py-2 bg-slate-800 text-indigo-400 rounded-lg text-sm font-bold hover:bg-slate-700">Simulate
                        App</button>
                </div>
            </div>
        </div>

        <!-- Settings: Set New Secret -->
        <div id="screen-settings-input" class="absolute inset-0 z-50 bg-slate-950 hidden flex flex-col">
            <div class="p-6 flex items-center gap-4">
                <button onclick="router.back()" class="p-2 hover:bg-slate-900 rounded-full"><i data-lucide="arrow-left"
                        class="w-6 h-6"></i></button>
                <h2 class="text-xl font-bold">Set New Secret</h2>
            </div>
            <div class="p-6 space-y-6 text-center">
                <div id="new-secret-icon"
                    class="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                    <!-- Icon injected -->
                </div>
                <h3 class="text-xl font-bold mb-2" id="new-secret-title">Enter New PIN</h3>
                <p class="text-slate-400 mb-6">Enter the new secret for your wallet.</p>

                <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 mb-8">
                    <input id="new-secret-input" type="password" placeholder="Enter new secret..."
                        class="w-full bg-transparent text-center text-2xl tracking-widest outline-none text-white">

                    <div id="new-secret-file-container" class="hidden">
                        <input type="file" id="new-secret-file" class="hidden"
                            onchange="settingsFlow.handleFileSelect(this)">
                        <button onclick="document.getElementById('new-secret-file').click()"
                            class="w-full py-8 border-2 border-dashed border-slate-700 rounded-xl flex flex-col items-center justify-center text-slate-400 hover:border-indigo-500 hover:text-indigo-500 transition-colors">
                            <i data-lucide="upload-cloud" class="w-8 h-8 mb-2"></i>
                            <span id="new-secret-filename">Click to Upload Key File</span>
                        </button>
                    </div>
                </div>

                <button onclick="settingsFlow.saveNewSecret()"
                    class="w-full py-4 bg-indigo-600 rounded-xl font-bold hover:bg-indigo-500">Save New Secret</button>
            </div>
        </div>

        <!-- Send Screen -->
        <div id="screen-send" class="absolute inset-0 z-40 bg-slate-950 hidden flex flex-col">
            <div class="p-6 flex items-center gap-4">
                <button onclick="router.back()" class="p-2 hover:bg-slate-900 rounded-full"><i data-lucide="arrow-left"
                        class="w-6 h-6"></i></button>
                <h2 class="text-xl font-bold">Send USDT</h2>
            </div>

            <div class="p-6 space-y-6">
                <!-- Step 1: Input -->
                <div id="send-step-1" class="space-y-4">
                    <div>
                        <label class="text-sm text-slate-400 block mb-2">Recipient</label>
                        <input type="text" value="0x71C...9A2"
                            class="w-full bg-slate-900 border border-slate-800 rounded-xl p-4 text-white focus:outline-none focus:border-indigo-500 transition-colors">
                    </div>
                    <div>
                        <label class="text-sm text-slate-400 block mb-2">Amount</label>
                        <input type="number" value="100"
                            class="w-full bg-slate-900 border border-slate-800 rounded-xl p-4 text-white focus:outline-none focus:border-indigo-500 transition-colors">
                    </div>
                    <button onclick="sendFlow.next()"
                        class="w-full py-4 bg-indigo-600 rounded-xl font-bold mt-4 hover:bg-indigo-500">Next</button>
                </div>

                <!-- Step 2: ZK Proof -->
                <div id="send-step-2" class="hidden text-center py-8">
                    <div
                        class="w-20 h-20 bg-emerald-500/10 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                        <i data-lucide="shield-check" class="w-10 h-10 text-emerald-500"></i>
                    </div>
                    <h3 class="text-xl font-bold mb-2">Generating ZK Proof</h3>
                    <p class="text-slate-400 mb-8">Proving sufficient balance without revealing total funds...</p>
                    <button onclick="sendFlow.next()"
                        class="w-full py-4 bg-emerald-600 rounded-xl font-bold hover:bg-emerald-500">Proof
                        Generated</button>
                </div>

                <!-- Step 3: Method Selection -->
                <div id="send-step-3" class="hidden space-y-6">
                    <div class="text-center">
                        <h3 class="text-xl font-bold mb-2">Select Auth Method</h3>
                        <p class="text-slate-400">Choose how to authorize this transfer.</p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="sendFlow.selectMethod('pin')"
                            class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                            <i data-lucide="grid" class="w-8 h-8 text-indigo-500"></i>
                            <span class="font-bold">PIN</span>
                        </button>
                        <button onclick="sendFlow.selectMethod('pattern')"
                            class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                            <i data-lucide="lock" class="w-8 h-8 text-blue-500"></i>
                            <span class="font-bold">Pattern</span>
                        </button>
                        <button onclick="sendFlow.selectMethod('password')"
                            class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                            <i data-lucide="key" class="w-8 h-8 text-amber-500"></i>
                            <span class="font-bold">Password</span>
                        </button>
                        <button onclick="sendFlow.selectMethod('file')"
                            class="p-4 bg-slate-900 border border-slate-800 rounded-xl hover:border-indigo-500 flex flex-col items-center gap-2">
                            <i data-lucide="file-audio" class="w-8 h-8 text-pink-500"></i>
                            <span class="font-bold">File Key</span>
                        </button>
                    </div>
                </div>

                <!-- Step 4: Auth Input -->
                <div id="send-step-4" class="hidden text-center py-8">
                    <div id="auth-icon-container"
                        class="w-20 h-20 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-6">
                        <!-- Icon injected by JS -->
                    </div>
                    <h3 class="text-xl font-bold mb-2" id="auth-title">Enter Secret</h3>

                    <div class="bg-slate-900 p-4 rounded-xl border border-slate-800 mb-8">
                        <input id="auth-input" type="password" placeholder="Enter secret..."
                            class="w-full bg-transparent text-center text-2xl tracking-widest outline-none text-white">

                        <div id="auth-file-container" class="hidden">
                            <input type="file" id="auth-file" class="hidden" onchange="sendFlow.handleFileSelect(this)">
                            <button onclick="document.getElementById('auth-file').click()"
                                class="w-full py-8 border-2 border-dashed border-slate-700 rounded-xl flex flex-col items-center justify-center text-slate-400 hover:border-indigo-500 hover:text-indigo-500 transition-colors">
                                <i data-lucide="upload-cloud" class="w-8 h-8 mb-2"></i>
                                <span id="auth-filename">Click to Upload Key File</span>
                            </button>
                        </div>
                    </div>

                    <button onclick="sendFlow.finish()"
                        class="w-full py-4 bg-indigo-600 rounded-xl font-bold hover:bg-indigo-500">Verify &
                        Send</button>
                </div>
            </div>
        </div>

    </div>

    <script>
        // Initialize Icons
        lucide.createIcons();

        // Simple Router
        const router = {
            history: [],
            push(screenId) {
                this.history.push(screenId);
                document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById('screen-' + screenId).classList.remove('hidden');
                lucide.createIcons();
            },
            back() {
                this.history.pop(); // current
                const prev = this.history[this.history.length - 1] || 'onboarding';
                document.querySelectorAll('[id^="screen-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById('screen-' + prev).classList.remove('hidden');
            }
        };

        // Global Secrets Store
        const storedSecrets = {
            pin: "1234",
            pattern: "1234",
            password: "password",
            file: null // Will store DataURL
        };

        // Send Flow Logic
        const sendFlow = {
            step: 1,
            method: null,
            currentFileAttempt: null, // Store uploaded file content
            next() {
                document.getElementById('send-step-' + this.step).classList.add('hidden');
                this.step++;
                document.getElementById('send-step-' + this.step).classList.remove('hidden');
            },
            selectMethod(method) {
                this.method = method;
                console.log(`[Send] User selected auth method: ${method}`);
                this.next(); // Go to step 4

                // Update UI for Step 4
                let title = 'Enter Secret';
                let iconName = 'lock';

                switch (method) {
                    case 'pin': title = 'Enter PIN'; iconName = 'grid'; break;
                    case 'pattern': title = 'Draw Pattern'; iconName = 'lock'; break;
                    case 'password': title = 'Enter Password'; iconName = 'key'; break;
                    case 'file': title = 'Upload Key File'; iconName = 'file-audio'; break;
                }

                document.getElementById('auth-title').innerText = title;
                document.getElementById('auth-icon-container').innerHTML = `<i data-lucide="${iconName}" class="w-10 h-10 text-white"></i>`;

                // Toggle Input Type
                if (method === 'file') {
                    document.getElementById('auth-input').classList.add('hidden');
                    document.getElementById('auth-file-container').classList.remove('hidden');
                } else {
                    document.getElementById('auth-input').classList.remove('hidden');
                    document.getElementById('auth-file-container').classList.add('hidden');
                    document.getElementById('auth-input').value = ''; // Clear input
                }

                lucide.createIcons();
            },
            handleFileSelect(input) {
                if (input.files && input.files[0]) {
                    const file = input.files[0];
                    document.getElementById('auth-filename').innerText = file.name;
                    document.getElementById('auth-filename').classList.add('text-indigo-400', 'font-bold');

                    // Read file
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.currentFileAttempt = e.target.result;
                        console.log('[Send] File read successfully');
                    };
                    reader.readAsDataURL(file);
                }
            },
            finish() {
                console.log(`[Send] Transaction authorized via ${this.method}`);

                // Verification Logic
                let isValid = false;
                const inputVal = document.getElementById('auth-input').value;

                if (this.method === 'file') {
                    if (!this.currentFileAttempt) {
                        alert('Please upload a key file!');
                        return;
                    }
                    if (this.currentFileAttempt === storedSecrets.file) {
                        isValid = true;
                    } else {
                        console.warn('[Send] File mismatch!');
                    }
                } else {
                    // Simple check for demo purposes (in real app, hash check)
                    if (inputVal === storedSecrets[this.method]) {
                        isValid = true;
                    }
                }

                if (isValid) {
                    alert('Transaction Sent! Authorized via ' + this.method.toUpperCase());
                    this.reset();
                    router.push('dashboard');
                } else {
                    alert('Authentication Failed! Invalid Secret or File.');
                }
            },
            reset() {
                this.step = 1;
                this.method = null;
                this.currentFileAttempt = null;
                document.querySelectorAll('[id^="send-step-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById('send-step-1').classList.remove('hidden');
            }
        };

        // Settings Flow Logic
        const settingsFlow = {
            approvals: { desktop: false, mobile: false },
            newMethod: null,
            timer: null,
            pendingNewFileSecret: null, // Store file content to save

            startChange() {
                console.log('[Settings] Initiated security change request');
                router.push('settings-change');
            },

            selectMethod(method) {
                this.newMethod = method;
                this.approvals = { desktop: false, mobile: false };
                console.log(`[Settings] Selected new method: ${method}. Waiting for dual approval.`);

                // Reset buttons
                const btnD = document.getElementById('btn-approve-desktop');
                const btnM = document.getElementById('btn-approve-mobile');

                btnD.innerText = "Approve Here";
                btnD.className = "px-4 py-2 bg-indigo-600 rounded-lg text-sm font-bold hover:bg-indigo-500";
                btnD.disabled = false;

                btnM.innerText = "Simulate App";
                btnM.className = "px-4 py-2 bg-slate-800 text-indigo-400 rounded-lg text-sm font-bold hover:bg-slate-700";
                btnM.disabled = false;

                router.push('settings-dual');

                // Start Timeout (30s)
                if (this.timer) clearTimeout(this.timer);
                this.timer = setTimeout(() => {
                    if (!this.approvals.desktop || !this.approvals.mobile) {
                        console.log('[Settings] Dual approval timed out. Operation cancelled.');
                        alert('Operation Timed Out! Security change cancelled.');
                        router.push('settings');
                    }
                }, 30000);
            },

            approve(device) {
                this.approvals[device] = true;
                console.log(`[Settings] Approved by ${device}`);

                const btn = document.getElementById('btn-approve-' + device);
                btn.innerText = "Approved";
                btn.className = "px-4 py-2 bg-emerald-500/20 text-emerald-500 rounded-lg text-sm font-bold";
                btn.disabled = true;

                if (this.approvals.desktop && this.approvals.mobile) {
                    if (this.timer) clearTimeout(this.timer);
                    console.log(`[Settings] Dual approval complete. Proceeding to input new secret.`);

                    setTimeout(() => {
                        // Navigate to Input Screen
                        let title = 'Enter New Secret';
                        let iconName = 'lock';
                        switch (this.newMethod) {
                            case 'pin': title = 'Enter New PIN'; iconName = 'grid'; break;
                            case 'pattern': title = 'Draw New Pattern'; iconName = 'lock'; break;
                            case 'password': title = 'Enter New Password'; iconName = 'key'; break;
                            case 'file': title = 'Upload New Key File'; iconName = 'file-audio'; break;
                        }
                        document.getElementById('new-secret-title').innerText = title;
                        document.getElementById('new-secret-icon').innerHTML = `<i data-lucide="${iconName}" class="w-10 h-10 text-white"></i>`;

                        // Toggle Input Type
                        if (this.newMethod === 'file') {
                            document.getElementById('new-secret-input').classList.add('hidden');
                            document.getElementById('new-secret-file-container').classList.remove('hidden');
                        } else {
                            document.getElementById('new-secret-input').classList.remove('hidden');
                            document.getElementById('new-secret-file-container').classList.add('hidden');
                            document.getElementById('new-secret-input').value = '';
                        }

                        lucide.createIcons();

                        router.push('settings-input');
                    }, 500);
                }
            },

            handleFileSelect(input) {
                if (input.files && input.files[0]) {
                    const file = input.files[0];
                    document.getElementById('new-secret-filename').innerText = file.name;
                    document.getElementById('new-secret-filename').classList.add('text-indigo-400', 'font-bold');

                    // Read file
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        this.pendingNewFileSecret = e.target.result;
                        console.log('[Settings] New key file read successfully');
                    };
                    reader.readAsDataURL(file);
                }
            },

            saveNewSecret() {
                const inputVal = document.getElementById('new-secret-input').value;

                if (this.newMethod === 'file') {
                    if (!this.pendingNewFileSecret) {
                        alert('Please upload a file first!');
                        return;
                    }
                    storedSecrets.file = this.pendingNewFileSecret;
                } else {
                    if (!inputVal) {
                        alert('Please enter a secret!');
                        return;
                    }
                    storedSecrets[this.newMethod] = inputVal;
                }

                console.log(`[Settings] New secret saved for method: ${this.newMethod}`);
                alert('Success! Security Settings Updated to ' + this.newMethod.toUpperCase());
                document.getElementById('active-method-display').innerText = this.newMethod.charAt(0).toUpperCase() + this.newMethod.slice(1);
                router.push('settings');
            }
        };
    </script>
</body>

</html>